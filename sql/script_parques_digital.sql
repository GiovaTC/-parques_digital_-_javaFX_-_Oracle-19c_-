-- ===============================
-- ? Script SQL - Parques Digital
-- ===============================

-- Tabla de jugadores
CREATE TABLE PLAYERS (
  PLAYER_ID   NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  USERNAME    VARCHAR2(100) NOT NULL,
  CREATED_AT  TIMESTAMP DEFAULT SYSTIMESTAMP
);

-- Tabla de sesiones de juego
CREATE TABLE GAME_SESSIONS (
  SESSION_ID       NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  STARTED_AT       TIMESTAMP DEFAULT SYSTIMESTAMP,
  ENDED_AT         TIMESTAMP,
  WINNER_PLAYER_ID NUMBER,
  CONSTRAINT FK_WINNER FOREIGN KEY (WINNER_PLAYER_ID)
    REFERENCES PLAYERS(PLAYER_ID)
);

-- Tabla de movimientos realizados
CREATE TABLE MOVES (
  MOVE_ID     NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  SESSION_ID  NUMBER NOT NULL,
  PLAYER_ID   NUMBER NOT NULL,
  MOVE_NUMBER NUMBER NOT NULL,
  FROM_POS    NUMBER,
  TO_POS      NUMBER,
  DICE_VALUE  NUMBER,
  CREATED_AT  TIMESTAMP DEFAULT SYSTIMESTAMP,

  CONSTRAINT FK_SESSION FOREIGN KEY (SESSION_ID)
    REFERENCES GAME_SESSIONS(SESSION_ID),
  CONSTRAINT FK_PLAYER FOREIGN KEY (PLAYER_ID)
    REFERENCES PLAYERS(PLAYER_ID)
);

COMMIT;